<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester - Student Dropout Prediction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>üß™ API Tester - Student Dropout Prediction</h3>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="apiUrl" class="form-label">API Base URL:</label>
                            <input type="url" class="form-control" id="apiUrl" 
                                   placeholder="https://your-app-name.onrender.com"
                                   value="">
                        </div>
                        
                        <div class="d-grid gap-2 mb-4">
                            <button class="btn btn-primary" onclick="testHealth()">üè• Test Health Endpoint</button>
                            <button class="btn btn-success" onclick="testGoodStudent()">üë®‚Äçüéì Test Good Student (Low Risk)</button>
                            <button class="btn btn-warning" onclick="testAverageStudent()">üìö Test Average Student</button>
                            <button class="btn btn-danger" onclick="testRiskyStudent()">‚ö†Ô∏è Test Risky Student</button>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h5>üìä Test Results</h5>
                            </div>
                            <div class="card-body">
                                <div id="results" style="max-height: 400px; overflow-y: auto;">
                                    <p class="text-muted">Click a test button to see results...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function getApiUrl() {
            const url = document.getElementById('apiUrl').value.trim();
            return url || 'https://your-app-name.onrender.com';
        }

        function addResult(title, content, type = 'info') {
            const results = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            
            const alertClass = {
                'success': 'alert-success',
                'error': 'alert-danger',
                'warning': 'alert-warning',
                'info': 'alert-info'
            }[type] || 'alert-info';
            
            results.innerHTML += `
                <div class="alert ${alertClass} mb-2">
                    <strong>${title}</strong> <small class="text-muted">(${timestamp})</small><br>
                    <div style="font-family: monospace; font-size: 0.9em; white-space: pre-wrap;">${content}</div>
                </div>
            `;
            results.scrollTop = results.scrollHeight;
        }

        async function testHealth() {
            const apiUrl = getApiUrl();
            addResult('üè• Health Check', `Testing: ${apiUrl}/health`, 'info');
            
            try {
                const response = await fetch(`${apiUrl}/health`);
                const data = await response.json();
                
                if (response.ok) {
                    addResult('‚úÖ Health Check Success', JSON.stringify(data, null, 2), 'success');
                } else {
                    addResult('‚ùå Health Check Failed', `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                addResult('‚ùå Health Check Error', error.message, 'error');
            }
        }

        async function testPrediction(studentData, testName) {
            const apiUrl = getApiUrl();
            addResult(`üß™ ${testName}`, `Testing prediction for ${testName.toLowerCase()}...`, 'info');
            
            try {
                const response = await fetch(`${apiUrl}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(studentData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    const result = `Prediction: ${data.prediction_label || 'Unknown'}
Confidence: ${(data.confidence || 0).toFixed(3)}
Model Used: ${data.model_used || 'Unknown'}
${data.risk_factors ? 'Risk Factors: ' + JSON.stringify(data.risk_factors, null, 2) : ''}`;
                    
                    const alertType = data.prediction_label === 'Dropout' ? 'warning' : 
                                    data.prediction_label === 'Graduate' ? 'success' : 'info';
                    
                    addResult(`‚úÖ ${testName} Result`, result, alertType);
                } else {
                    addResult(`‚ùå ${testName} Failed`, `Status: ${response.status}\n${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå ${testName} Error`, error.message, 'error');
            }
        }

        function testGoodStudent() {
            const goodStudent = {
                marital_status: 1,
                application_mode: 1,
                course: 9238,
                daytime_evening_attendance: 1,
                previous_qualification: 1,
                nationality: 1,
                mothers_qualification: 1,
                fathers_qualification: 1,
                mothers_occupation: 1,
                fathers_occupation: 1,
                displaced: 0,
                educational_special_needs: 0,
                debtor: 0,
                tuition_fees_up_to_date: 1,
                gender: 1,
                scholarship_holder: 1,
                age_at_enrollment: 19,
                international: 0,
                curricular_units_1st_sem_credited: 6,
                curricular_units_1st_sem_grade: 16.8,
                curricular_units_2nd_sem_credited: 6,
                curricular_units_2nd_sem_grade: 17.2,
                curricular_units_1st_sem_approved: 6
            };
            testPrediction(goodStudent, 'Good Student (Should Graduate)');
        }

        function testAverageStudent() {
            const averageStudent = {
                marital_status: 1,
                application_mode: 1,
                course: 9238,
                daytime_evening_attendance: 1,
                previous_qualification: 1,
                nationality: 1,
                mothers_qualification: 1,
                fathers_qualification: 1,
                mothers_occupation: 1,
                fathers_occupation: 1,
                displaced: 0,
                educational_special_needs: 0,
                debtor: 0,
                tuition_fees_up_to_date: 1,
                gender: 1,
                scholarship_holder: 0,
                age_at_enrollment: 22,
                international: 0,
                curricular_units_1st_sem_credited: 4,
                curricular_units_1st_sem_grade: 12.5,
                curricular_units_2nd_sem_credited: 5,
                curricular_units_2nd_sem_grade: 13.1,
                curricular_units_1st_sem_approved: 4
            };
            testPrediction(averageStudent, 'Average Student (Should Stay Enrolled)');
        }

        function testRiskyStudent() {
            const riskyStudent = {
                marital_status: 1,
                application_mode: 1,
                course: 9238,
                daytime_evening_attendance: 1,
                previous_qualification: 1,
                nationality: 1,
                mothers_qualification: 1,
                fathers_qualification: 1,
                mothers_occupation: 1,
                fathers_occupation: 1,
                displaced: 0,
                educational_special_needs: 0,
                debtor: 1,
                tuition_fees_up_to_date: 0,
                gender: 1,
                scholarship_holder: 0,
                age_at_enrollment: 35,
                international: 0,
                curricular_units_1st_sem_credited: 2,
                curricular_units_1st_sem_grade: 8.5,
                curricular_units_2nd_sem_credited: 1,
                curricular_units_2nd_sem_grade: 7.2,
                curricular_units_1st_sem_approved: 1
            };
            testPrediction(riskyStudent, 'Risky Student (Likely Dropout)');
        }

        // Auto-populate URL if provided in query string
        window.addEventListener('load', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const apiUrl = urlParams.get('api');
            if (apiUrl) {
                document.getElementById('apiUrl').value = apiUrl;
            }
        });
    </script>
</body>
</html>